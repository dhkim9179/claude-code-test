-- 마일리지 테이블
-- 회원의 현재 마일리지 잔액 정보를 저장
CREATE TABLE IF NOT EXISTS MILEAGE (
    MEMBER_ID BIGINT PRIMARY KEY COMMENT '회원 ID',
    BALANCE BIGINT NOT NULL DEFAULT 0 COMMENT '마일리지 잔액',
    CREATE_DATE TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '생성일시',
    UPDATE_DATE TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '수정일시'
);

-- 마일리지 이력 테이블
-- 마일리지 적립/사용 이력을 저장
CREATE TABLE IF NOT EXISTS MILEAGE_HISTORY (
    ID BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '이력 ID',
    MILEAGE_MEMBER_ID BIGINT NOT NULL COMMENT '회원 ID',
    TYPE VARCHAR(20) NOT NULL COMMENT '마일리지 유형 (EARN: 적립, USE: 사용)',
    AMOUNT INTEGER NOT NULL COMMENT '마일리지 금액',
    DESCRIPTION VARCHAR(500) COMMENT '설명',
    CREATE_DATE TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '생성일시',
    CONSTRAINT FK_MILEAGE_HISTORY_MEMBER FOREIGN KEY (MILEAGE_MEMBER_ID) REFERENCES MILEAGE(MEMBER_ID)
);

-- 마일리지 이력 조회 성능 향상을 위한 인덱스
CREATE INDEX IF NOT EXISTS IDX_MILEAGE_HISTORY_MEMBER_DATE
    ON MILEAGE_HISTORY(MILEAGE_MEMBER_ID, CREATE_DATE);

CREATE INDEX IF NOT EXISTS IDX_MILEAGE_HISTORY_CREATE_DATE
    ON MILEAGE_HISTORY(CREATE_DATE);

-- 일별 마일리지 집계 테이블
-- 일 단위로 마일리지 적립 및 사용 금액을 집계하여 저장
CREATE TABLE IF NOT EXISTS MILEAGE_DAILY_SUMMARY (
    SUMMARY_DATE DATE PRIMARY KEY COMMENT '집계 일자',
    TOTAL_EARN_AMOUNT BIGINT NOT NULL DEFAULT 0 COMMENT '총 적립 금액',
    TOTAL_EARN_COUNT BIGINT NOT NULL DEFAULT 0 COMMENT '총 적립 건수',
    TOTAL_USE_AMOUNT BIGINT NOT NULL DEFAULT 0 COMMENT '총 사용 금액',
    TOTAL_USE_COUNT BIGINT NOT NULL DEFAULT 0 COMMENT '총 사용 건수',
    NET_AMOUNT BIGINT NOT NULL DEFAULT 0 COMMENT '순 증감액 (적립 - 사용)',
    CREATE_DATE TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '생성일시',
    UPDATE_DATE TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '수정일시'
);
